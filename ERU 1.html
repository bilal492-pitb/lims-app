<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIMS - New Registration</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
        }

        /* Header Styles */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #009688;
            color: white;
            padding: 10px 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .logo-section {
            display: flex;
            align-items: center;
        }

        .logo-section i {
            font-size: 24px;
            margin-right: 10px;
        }

        .logo-text {
            font-size: 24px;
            font-weight: bold;
        }

        .search-bar {
            flex: 1;
            margin: 0 20px;
            max-width: 500px;
        }

        .search-bar input {
            width: 100%;
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .search-bar input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .new-button {
            background-color: white;
            color: #333;
            padding: 8px 15px;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            margin-right: 15px;
        }

        .new-button i {
            margin-right: 8px;
        }

        .notification-icon {
            position: relative;
            margin-right: 15px;
            cursor: pointer;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #ff5722;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .user-profile {
            display: flex;
            align-items: center;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            background-color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
        }

        .user-avatar i {
            color: #009688;
            font-size: 20px;
        }

        .user-info {
            text-align: right;
        }

        .user-name {
            font-weight: bold;
        }

        .user-role {
            font-size: 12px;
            opacity: 0.9;
        }

        /* Main Container */
        .container {
            display: flex;
            height: calc(100vh - 60px);
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color: white;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.05);
            padding: 20px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 25px;
            color: #555;
            text-decoration: none;
            transition: background-color 0.3s;
        }

        .nav-item:hover {
            background-color: #f5f5f5;
        }

        .nav-item.active {
            background-color: #e0f2f1;
            color: #009688;
            border-left: 4px solid #009688;
            padding-left: 21px;
        }

        .nav-item i {
            margin-right: 12px;
            width: 20px;
            text-align: center;
        }

        .sub-nav-item {
            padding-left: 57px;
            font-size: 14px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .page-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: #333;
        }

        /* Form Styles */
        .form-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 25px;
            margin-bottom: 20px;
        }

        .form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .form-title {
            font-size: 18px;
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .registration-number {
            font-size: 14px;
            color: #555;
        }

        .registration-number span {
            font-weight: bold;
            color: #009688;
        }

        .form-section {
            margin-bottom: 25px;
        }

        .form-section-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }

        .form-row {
            display: flex;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .form-group {
            flex: 1;
            min-width: 250px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-control:focus {
            border-color: #009688;
            outline: none;
        }

        select.form-control {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 16px;
        }

        .form-text {
            font-size: 12px;
            color: #777;
            margin-top: 5px;
        }

        .form-check {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .form-check-input {
            margin-right: 10px;
        }

        .radio-group {
            display: flex;
            gap: 20px;
        }

        .radio-option {
            display: flex;
            align-items: center;
        }

        .radio-option input {
            margin-right: 5px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
        }

        .btn-primary {
            background-color: #009688;
            color: white;
        }

        .btn-primary:hover {
            background-color: #00796b;
        }

        .btn-secondary {
            background-color: #f5f5f5;
            color: #333;
        }

        .btn-secondary:hover {
            background-color: #e0e0e0;
        }

        .btn-danger {
            background-color: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background-color: #d32f2f;
        }

        .btn-success {
            background-color: #4caf50;
            color: white;
        }

        .btn-success:hover {
            background-color: #388e3c;
        }

        .btn-warning {
            background-color: #ff9800;
            color: white;
        }

        .btn-warning:hover {
            background-color: #f57c00;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
            gap: 10px;
        }

        /* Test Fee Table */
        .test-fee-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .test-fee-table th, .test-fee-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .test-fee-table th {
            font-weight: 600;
            color: #555;
        }

        .total-amount {
            font-weight: bold;
            text-align: right;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 4px;
            margin-top: 10px;
        }

        /* Sample Section Styles */
        .sample-container {
            border: 1px solid #eee;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
            background-color: #f9f9f9;
        }

        .sample-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .sample-title {
            font-weight: bold;
            margin: 0;
        }

        .sample-actions {
            display: flex;
            gap: 10px;
        }

        .sample-actions button {
            padding: 5px 10px;
            font-size: 12px;
        }

        .add-sample-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            background-color: #e0f2f1;
            border: 1px dashed #009688;
            border-radius: 4px;
            color: #009688;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.3s;
        }

        .add-sample-btn:hover {
            background-color: #b2dfdb;
        }

        .add-sample-btn i {
            margin-right: 8px;
        }

        .grand-total {
            font-weight: bold;
            text-align: right;
            padding: 15px;
            background-color: #e0f2f1;
            border-radius: 4px;
            margin-top: 20px;
            color: #00796b;
            font-size: 16px;
        }

        /* Responsive Styles */
        @media (max-width: 992px) {
            .search-bar {
                display: none;
            }
            
            .form-group {
                flex: 100%;
                margin-right: 0;
            }
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                height: auto;
            }
            
            .sidebar {
                width: 100%;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            }
            
            .user-info {
                display: none;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .form-actions .btn {
                width: 100%;
                margin-left: 0;
                margin-bottom: 10px;
            }
        }

        /* Add this CSS to hide sample content by default */
        .sample-container .sample-content {
            display: none;
            margin-top: 15px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .sample-container.expanded .sample-content {
            display: block;
        }
        .sample-header {
            cursor: pointer;
            padding: 10px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .sample-title {
            font-weight: bold;
            margin: 0;
        }
        .sample-container {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="logo-section">
            <i class="fas fa-flask"></i>
            <span class="logo-text">LIMS</span>
        </div>
        
        <div class="search-bar">
            <input type="text" placeholder="Search...">
        </div>
        
        <div class="new-button">
            <i class="fas fa-plus"></i>
            <span>New</span>
        </div>
        
        <div class="notification-icon">
            <i class="fas fa-bell"></i>
            <span class="notification-badge">3</span>
        </div>
        
        <div class="user-profile">
            <div class="user-avatar">
                <i class="fas fa-user"></i>
            </div>
            <div class="user-info">
                <div class="user-name">ERU</div>
                <div class="user-role">Reception</div>
            </div>
        </div>
    </div>
        <!-- Main Content -->
        <div class="main-content">
            <h1 class="page-title">New Registration</h1>
            
            <!-- Registration Form -->
            <div class="form-container">
                <div class="form-header">
                    <h2 class="form-title">Sample Registration Form</h2>
                    <div class="registration-number">
                        Registration Number: <span>PAFDA-25-000001</span>
                    </div>
                </div>
                
                <form id="registrationForm">
                    <!-- Registration Type Selection -->
                    <div class="form-section">
                        <h3 class="form-section-title">Registration Type</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Registration Type *</label>
                                <div class="radio-group">
                                    <label class="radio-option">
                                        <input type="radio" name="registrationType" value="individual" checked> Self / Individual
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="registrationType" value="panel"> Panel Company
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Panel Company Selection (initially hidden) -->
                        <div class="form-row" id="panelCompanyRow" style="display: none;">
                            <div class="form-group" style="width: 100%;">
                                <label class="form-label" for="panelCompanySelect">Select Panel Company *</label>
                                <select class="form-control" id="panelCompanySelect" onchange="populatePanelCompanyDetails()">
                                    <option value="">-- Select Panel Company --</option>
                                    <option value="nestle">Nestle Pakistan Limited</option>
                                    <option value="unilever">Unilever Pakistan Limited</option>
                                    <option value="engro">Engro Foods Limited</option>
                                    <option value="shan">Shan Foods Private Limited</option>
                                    <option value="national">National Foods Limited</option>
                                    <option value="cocacola">Coca-Cola Beverages Pakistan Limited</option>
                                    <option value="pepsi">PepsiCo International Pakistan</option>
                                    <option value="shezan">Shezan International Limited</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Sender Details (shown by default for Self/Individual) -->
                    <div class="form-section" id="senderDetailsSection">
                        <h3 class="form-section-title">Sender Details</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="senderName">Name *</label>
                                <input type="text" class="form-control" id="senderName" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="designation">Designation *</label>
                                <input type="text" class="form-control" id="designation" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="department">Department *</label>
                                <input type="text" class="form-control" id="department" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="province">Province *</label>
                                <input type="text" class="form-control" id="province" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="division">Division *</label>
                                <input type="text" class="form-control" id="division" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="district">District *</label>
                                <input type="text" class="form-control" id="district" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="streetNo">Street No *</label>
                            <input type="text" class="form-control" id="streetNo" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="area">Area *</label>
                            <input type="text" class="form-control" id="area" required>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="address">Address *</label>
                                <input type="text" class="form-control" id="address" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="contactNumber">Contact Number *</label>
                                <input type="tel" class="form-control" id="contactNumber" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="cnic">CNIC *</label>
                                <input type="text" class="form-control" id="cnic" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="email">Email ID</label>
                                <input type="email" class="form-control" id="email">
                            </div>
                        </div>
                    </div>

                    <!-- Panel Company Details (initially hidden) -->
                    <div class="form-section" id="panelCompanyDetailsSection" style="display: none;">
                        <h3 class="form-section-title">Company Details</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="companyName">Company Name</label>
                                <input type="text" class="form-control" id="companyName" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="companyContact">Company Contact</label>
                                <input type="text" class="form-control" id="companyContact" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="companyEmail">Company Email</label>
                                <input type="email" class="form-control" id="companyEmail" readonly>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group" style="width: 100%;">
                                <label class="form-label" for="companyAddress">Company Address</label>
                                <textarea class="form-control" id="companyAddress" rows="2" readonly></textarea>
                            </div>
                        </div>
                        <h4 class="form-subsection-title">Focal Person Details</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="focalPersonName">Focal Person Name</label>
                                <input type="text" class="form-control" id="focalPersonName" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="focalPersonContact">Contact Number</label>
                                <input type="text" class="form-control" id="focalPersonContact" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="focalPersonDesignation">Designation</label>
                                <input type="text" class="form-control" id="focalPersonDesignation" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="focalPersonEmail">Email</label>
                                <input type="email" class="form-control" id="focalPersonEmail" readonly>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Delivery Method Section -->
                    <div class="form-section">
                        <h3 class="form-section-title">Delivered Via</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <div class="delivery-options">
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="checkbox" id="deliverySelf" value="self">
                                        <label class="form-check-label" for="deliverySelf">Self</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="checkbox" id="deliveryAuthorized" value="authorized">
                                        <label class="form-check-label" for="deliveryAuthorized">Authorized Person</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="checkbox" id="deliveryCourier" value="courier">
                                        <label class="form-check-label" for="deliveryCourier">Courier Service</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Authorized Person Fields (hidden by default) -->
                        <div class="form-row authorized-person-fields" style="display: none;">
                            <div class="form-group">
                                <label class="form-label" for="authorizedName">Name *</label>
                                <input type="text" class="form-control" id="authorizedName" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="authorizedCnic">CNIC *</label>
                                <input type="text" class="form-control" id="authorizedCnic" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="authorizedContact">Contact Number *</label>
                                <input type="tel" class="form-control" id="authorizedContact" required>
                            </div>
                        </div>
                        
                        <div class="form-row authorized-person-fields" style="display: none;">
                            <div class="form-group">
                                <label class="form-label" for="authorizedStreet">Street No *</label>
                                <input type="text" class="form-control" id="authorizedStreet" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="authorizedArea">Area *</label>
                                <input type="text" class="form-control" id="authorizedArea" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="authorizedAddress">Address *</label>
                                <input type="text" class="form-control" id="authorizedAddress" required>
                            </div>
                        </div>
                    </div>

                    <!-- Courier Service Section (hidden by default) -->
                    <div class="form-section courier-fields" style="display: none;">
                        <div id="courierSection">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="courierCompany">Company Name *</label>
                                    <input type="text" class="form-control" id="courierCompany">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="courierContact">Contact *</label>
                                    <input type="tel" class="form-control" id="courierContact">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="courierAddress">Address *</label>
                                    <textarea class="form-control" id="courierAddress" rows="3"></textarea>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="trackingNumber">Parcel Tracking Number *</label>
                                    <input type="text" class="form-control" id="trackingNumber">
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" for="dispatchDate">Dispatch Date *</label>
                                        <input type="text" class="form-control" id="dispatchDate">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="courierRemarks">Remarks/Notes</label>
                                    <textarea class="form-control" id="courierRemarks" rows="3"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Packaging Details Section -->
                    <div class="form-section">
                        <h3 class="form-section-title">Packaging Details</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="packagingType">Packaging Type *</label>
                                <select class="form-control" id="packagingType" required>
                                    <option value="">-- Select Packaging Type --</option>
                                    <option value="wooden">Wooden</option>
                                    <option value="cardboard">Cardboard</option>
                                    <option value="plastic">Plastic</option>
                                    <option value="glass">Glass</option>
                                    <option value="metal">Metal</option>
                                    <option value="fabric">Fabric/Cloth</option>
                                    <option value="paper">Paper</option>
                                    <option value="foam">Foam</option>
                                    <option value="vacuum">Vacuum Sealed</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="sealCondition">Seal Condition *</label>
                                <select class="form-control" id="sealCondition" required>
                                    <option value="">-- Select Seal Condition --</option>
                                    <option value="intact">Intact/Sealed</option>
                                    <option value="broken">Broken/Unsealed</option>
                                    <option value="tampered">Tampered</option>
                                    <option value="leaking">Leaking</option>
                                    <option value="damaged">Damaged</option>
                                    <option value="partially_sealed">Partially Sealed</option>
                                    <option value="resealed">Resealed</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Package Type *</label>
                                <div class="radio-group">
                                    <label class="radio-option">
                                        <input type="radio" name="packageType" value="single" required> Single Package
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="packageType" value="multiple"> Multiple Packages
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="packageType" value="bulk"> Bulk Packaging
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="packageType" value="individual"> Individual Units
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group" style="width: 100%;">
                                <label class="form-label" for="labelDetails">Label Details</label>
                                <div style="display: flex; gap: 10px; width: 100%;">
                                    <input type="text" class="form-control" id="labelDetails" style="flex: 1;" placeholder="Enter label information">
                                    <label class="btn btn-secondary" style="margin: 0; white-space: nowrap;">
                                        <i class="fas fa-paperclip"></i> Attach Image
                                        <input type="file" id="labelImage" accept="image/*" style="display: none;">
                                    </label>
                                </div>
                                <div id="imagePreview" style="margin-top: 10px; display: none;">
                                    <img id="previewImage" src="#" alt="Label Preview" style="max-width: 200px; max-height: 150px; border: 1px solid #ddd; border-radius: 4px;">
                                    <button type="button" id="removeImage" class="btn btn-sm btn-danger" style="margin-left: 10px;">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group" style="width: 100%;">
                                <label class="form-label" for="packagingNotes">Packaging Notes</label>
                                <textarea class="form-control" id="packagingNotes" rows="2" placeholder="Any additional notes about the packaging"></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Samples Section -->
                    <div class="form-section">
                        <div class="form-row" style="justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 class="form-section-title" style="margin-bottom: 0;">Samples Management</h3>
                            <button type="button" class="btn btn-primary" id="addSampleBtn">
                                <i class="fas fa-plus"></i> Add Sample
                            </button>
                        </div>
                        
                        <div id="samplesContainer">
                            <!-- Sample containers will be added here dynamically -->
                        </div>
                        
                        <!-- Grand Total -->
                        <div class="grand-total">
                            Grand Total: Rs. <span id="grandTotal">0.00</span>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-eye"></i> Preview
                        </button>
                        <button type="button" class="btn btn-secondary ml-2">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Sample counter
        let sampleCounter = 0;
        
        // Lab and sample type data with tests
        const labData = {
            food: {
                name: 'Food',
                sampleTypes: {
                    'dairy': 'Dairy Products',
                    'meat': 'Meat & Poultry',
                    'beverages': 'Beverages',
                    'bakery': 'Bakery Products',
                    'oils': 'Edible Oils'
                },
                tests: {
                    'dairy': [
                        { code: 'FAT', name: 'Fat Content', price: 2000 },
                        { code: 'SNF', name: 'SNF Content', price: 1500 },
                        { code: 'ADUL', name: 'Adulteration Test', price: 2500 },
                        { code: 'MICRO', name: 'Microbiological Analysis', price: 3000 }
                    ],
                    'meat': [
                        { code: 'PROT', name: 'Protein Content', price: 2500 },
                        { code: 'FAT', name: 'Fat Content', price: 2000 },
                        { code: 'MOIST', name: 'Moisture Content', price: 1800 },
                        { code: 'MICRO', name: 'Microbiological Analysis', price: 3500 }
                    ],
                    'beverages': [
                        { code: 'PROT', name: 'Protein Content', price: 2500 },
                        { code: 'FAT', name: 'Fat Content', price: 2000 },
                        { code: 'MOIST', name: 'Moisture Content', price: 1800 },
                        { code: 'MICRO', name: 'Microbiological Analysis', price: 3500 }
                    ],
                    'bakery': [
                        { code: 'PROT', name: 'Protein Content', price: 2500 },
                        { code: 'FAT', name: 'Fat Content', price: 2000 },
                        { code: 'MOIST', name: 'Moisture Content', price: 1800 },
                        { code: 'MICRO', name: 'Microbiological Analysis', price: 3500 }
                    ],
                    'oils': [
                        { code: 'PROT', name: 'Protein Content', price: 2500 },
                        { code: 'FAT', name: 'Fat Content', price: 2000 },
                        { code: 'MOIST', name: 'Moisture Content', price: 1800 },
                        { code: 'MICRO', name: 'Microbiological Analysis', price: 3500 }
                    ],
                    // Add more tests for other sample types as needed
                }
            },
            drug: {
                name: 'Drug',
                sampleTypes: {
                    'tablets': 'Tablets',
                    'syrups': 'Syrups',
                    'injections': 'Injections',
                    'capsules': 'Capsules',
                    'ointments': 'Ointments'
                },
                tests: {
                    'tablets': [
                        { code: 'ASSAY', name: 'Assay Test', price: 5000 },
                        { code: 'DISS', name: 'Dissolution Test', price: 4500 },
                        { code: 'DISINT', name: 'Disintegration Test', price: 3000 },
                        { code: 'IMP', name: 'Impurities Test', price: 6000 }
                    ],
                    'syrups': [
                        { code: 'ASSAY', name: 'Assay Test', price: 5500 },
                        { code: 'PH', name: 'pH Test', price: 2000 },
                        { code: 'VISC', name: 'Viscosity Test', price: 3000 },
                        { code: 'PRES', name: 'Preservative Test', price: 4000 }
                    ],
                    'injections': [
                        { code: 'ASSAY', name: 'Assay Test', price: 5500 },
                        { code: 'PH', name: 'pH Test', price: 2000 },
                        { code: 'VISC', name: 'Viscosity Test', price: 3000 },
                        { code: 'PRES', name: 'Preservative Test', price: 4000 }
                    ],
                    'capsules': [
                        { code: 'ASSAY', name: 'Assay Test', price: 5500 },
                        { code: 'PH', name: 'pH Test', price: 2000 },
                        { code: 'VISC', name: 'Viscosity Test', price: 3000 },
                        { code: 'PRES', name: 'Preservative Test', price: 4000 }
                    ],
                    'ointments': [
                        { code: 'ASSAY', name: 'Assay Test', price: 5500 },
                        { code: 'PH', name: 'pH Test', price: 2000 },
                        { code: 'VISC', name: 'Viscosity Test', price: 3000 },
                        { code: 'PRES', name: 'Preservative Test', price: 4000 }
                    ],
                    // Add more tests for other sample types as needed
                }
            },
            agricultural: {
                name: 'Agricultural',
                sampleTypes: {
                    'pesticides': 'Pesticides',
                    'fertilizers': 'Fertilizers',
                    'seeds': 'Seeds',
                    'soil': 'Soil Samples',
                    'water': 'Water Samples'
                },
                tests: {
                    'pesticides': [
                        { code: 'RESID', name: 'Residue Analysis', price: 4000 },
                        { code: 'PURITY', name: 'Purity Test', price: 3500 },
                        { code: 'EFF', name: 'Efficacy Test', price: 5000 }
                    ],
                    'fertilizers': [
                        { code: 'NPK', name: 'NPK Analysis', price: 3000 },
                        { code: 'HEAVY', name: 'Heavy Metals', price: 4000 },
                        { code: 'MOIST', name: 'Moisture Content', price: 1500 }
                    ],
                    'seeds': [
                        { code: 'NPK', name: 'NPK Analysis', price: 3000 },
                        { code: 'HEAVY', name: 'Heavy Metals', price: 4000 },
                        { code: 'MOIST', name: 'Moisture Content', price: 1500 }
                    ],
                    'soil': [
                        { code: 'NPK', name: 'NPK Analysis', price: 3000 },
                        { code: 'HEAVY', name: 'Heavy Metals', price: 4000 },
                        { code: 'MOIST', name: 'Moisture Content', price: 1500 }
                    ],
                    'water': [
                        { code: 'NPK', name: 'NPK Analysis', price: 3000 },
                        { code: 'HEAVY', name: 'Heavy Metals', price: 4000 },
                        { code: 'MOIST', name: 'Moisture Content', price: 1500 }
                    ],
                    // Add more tests for other sample types as needed
                }
            }
        };

        document.addEventListener('DOMContentLoaded', function() {
            // Registration type toggle
            const registrationTypeRadios = document.querySelectorAll('input[name="registrationType"]');
            const panelCompanyRow = document.getElementById('panelCompanyRow');
            const senderDetailsSection = document.getElementById('senderDetailsSection');
            const panelCompanyDetailsSection = document.getElementById('panelCompanyDetailsSection');

            registrationTypeRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'panel') {
                        panelCompanyRow.style.display = 'flex';
                        senderDetailsSection.style.display = 'none';
                        panelCompanyDetailsSection.style.display = 'block';
                    } else {
                        panelCompanyRow.style.display = 'none';
                        senderDetailsSection.style.display = 'block';
                        panelCompanyDetailsSection.style.display = 'none';
                        // Clear panel company details when switching back to individual
                        clearPanelCompanyDetails();
                    }
                });
            });

            // Add sample button click handler
            const addSampleBtn = document.getElementById('addSampleBtn');
            if (addSampleBtn) {
                addSampleBtn.addEventListener('click', addNewSample);
            }
            
            // Add first sample automatically but keep it collapsed
            addNewSample();
            
            // Delivery method toggle
            const deliveryToggles = document.querySelectorAll('.delivery-options .form-check-input');
            const authorizedPersonFields = document.querySelectorAll('.authorized-person-fields');
            const courierFields = document.querySelector('.courier-fields');
            const courierCheck = document.getElementById('courierCheck');

            // Remove the original courier checkbox event listener
            if (courierCheck) {
                courierCheck.addEventListener('change', function(e) {
                    e.stopPropagation();
                });
            }

            // Initialize with self delivery
            const deliverySelf = document.getElementById('deliverySelf');
            if (deliverySelf) {
                deliverySelf.checked = true;
            }

            // Hide all fields initially
            authorizedPersonFields.forEach(field => {
                field.style.display = 'none';
            });
            if (courierFields) {
                courierFields.style.display = 'none';
            }

            // Add event listeners to delivery toggles
            deliveryToggles.forEach(toggle => {
                toggle.addEventListener('change', function() {
                    // Uncheck other toggles
                    deliveryToggles.forEach(other => {
                        if (other !== this) {
                            other.checked = false;
                        }
                    });

                    // Handle field visibility
                    if (this.id === 'deliveryAuthorized' && this.checked) {
                        // Show authorized person fields
                        authorizedPersonFields.forEach(field => {
                            field.style.display = 'flex';
                        });
                        // Hide courier fields
                        if (courierFields) {
                            courierFields.style.display = 'none';
                        }
                        if (courierCheck) {
                            courierCheck.checked = false;
                        }
                    } else if (this.id === 'deliveryCourier' && this.checked) {
                        // Show courier fields
                        if (courierFields) {
                            courierFields.style.display = 'block';
                        }
                        if (courierCheck) {
                            courierCheck.checked = true;
                        }
                        // Hide authorized person fields
                        authorizedPersonFields.forEach(field => {
                            field.style.display = 'none';
                        });
                    } else {
                        // Hide all fields
                        authorizedPersonFields.forEach(field => {
                            field.style.display = 'none';
                        });
                        if (courierFields) {
                            courierFields.style.display = 'none';
                        }
                        if (courierCheck) {
                            courierCheck.checked = false;
                        }
                    }
                });
            });
        });

        // Function to add a new sample
        function addNewSample() {
            sampleCounter++;
            const sampleId = sampleCounter;
            
            const sampleContainer = document.createElement('div');
            sampleContainer.className = 'sample-container';
            sampleContainer.id = `sample_${sampleId}`;
            sampleContainer.dataset.sampleId = sampleId;
            
            sampleContainer.innerHTML = `
                <div class="sample-header" onclick="toggleSample('${sampleId}')">
                    <div class="sample-title">Sample #${sampleId}</div>
                    <div class="sample-actions">
                        <button type="button" class="btn btn-danger btn-sm remove-sample" onclick="event.stopPropagation(); removeSample('${sampleId}')">
                            <i class="fas fa-trash"></i> Remove
                        </button>
                    </div>
                </div>
                
                <div class="sample-content">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="labSelect_${sampleId}">Select Lab *</label>
                            <select class="form-control lab-select" id="labSelect_${sampleId}" required onchange="updateSampleTypes('${sampleId}')">
                                <option value="">-- Select Lab --</option>
                                <option value="food">Food Lab</option>
                                <option value="drug">Drug Lab</option>
                                <option value="agricultural">Agricultural Lab</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="sampleType_${sampleId}">Sample Type *</label>
                            <select class="form-control sample-type" id="sampleType_${sampleId}" required onchange="updateTestSelection('${sampleId}')">
                                <option value="">-- Select Sample Type --</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="manufacturerName_${sampleId}">Manufacturer Name</label>
                            <input type="text" class="form-control" id="manufacturerName_${sampleId}">
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="sampleCollectionDate_${sampleId}">Sample Collection Date</label>
                            <input type="date" class="form-control" id="sampleCollectionDate_${sampleId}">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="expiryDate_${sampleId}">Expiry Date</label>
                            <input type="date" class="form-control" id="expiryDate_${sampleId}">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="barcodeNumber_${sampleId}">Barcode Number</label>
                            <input type="text" class="form-control" id="barcodeNumber_${sampleId}">
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="offenderDetails_${sampleId}">Offender Details</label>
                            <input type="text" class="form-control" id="offenderDetails_${sampleId}">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group" style="width: 100%;">
                            <label class="form-label" for="additionalNote_${sampleId}">Additional Note</label>
                            <textarea class="form-control" id="additionalNote_${sampleId}" rows="2"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group" style="width: 100%;">
                            <label class="form-label" for="testSelect_${sampleId}">Select Tests (Multiple Selection) *</label>
                            <select class="form-control test-select" id="testSelect_${sampleId}" multiple 
                                    onchange="updateTestTable('${sampleId}')" style="height: 100px;">
                                <!-- Tests will be populated dynamically -->
                            </select>
                            <small class="form-text text-muted">Hold Ctrl (Windows) or Cmd (Mac) to select multiple tests</small>
                        </div>
                    </div>
                    
                    <div class="test-table-container">
                        <table class="test-fee-table">
                            <thead>
                                <tr>
                                    <th>Test Code</th>
                                    <th>Test Name</th>
                                    <th>Fee (Rs.)</th>
                                </tr>
                            </thead>
                            <tbody id="testTableBody_${sampleId}">
                                <!-- Test rows will be added dynamically -->
                            </tbody>
                        </table>
                        
                        <div class="total-amount">
                            Total Amount: Rs. <span id="totalAmount_${sampleId}">0.00</span>
                        </div>
                    </div>
                </div>
            `;
            
            // Add the new sample to the container
            const samplesContainer = document.getElementById('samplesContainer');
            samplesContainer.appendChild(sampleContainer);
            
            // Initialize test selection when a new sample is added
            const labSelect = document.getElementById(`labSelect_${sampleId}`);
            if (labSelect) {
                labSelect.addEventListener('change', function() {
                    updateTestSelection(sampleId);
                });
            }
            
            // Expand the newly added sample
            toggleSample(sampleId);
            
            return sampleContainer;
        }
        
        // Toggle sample content visibility
        function toggleSample(sampleId) {
            const sample = document.getElementById(`sample_${sampleId}`);
            if (sample) {
                sample.classList.toggle('expanded');
            }
        }
        
        // Update sample types based on selected lab
        function updateSampleTypes(sampleId) {
            const labSelect = document.getElementById(`labSelect_${sampleId}`);
            const sampleTypeSelect = document.getElementById(`sampleType_${sampleId}`);
            
            if (!labSelect || !sampleTypeSelect) return;
            
            const selectedLab = labSelect.value;
            
            // Clear existing options except the first one
            sampleTypeSelect.innerHTML = '<option value="">-- Select Sample Type --</option>';
            
            if (selectedLab && labData[selectedLab]) {
                // Add sample types for the selected lab
                Object.entries(labData[selectedLab].sampleTypes).forEach(([value, label]) => {
                    const option = document.createElement('option');
                    option.value = value;
                    option.textContent = label;
                    sampleTypeSelect.appendChild(option);
                });
            }
        }
        
        // Update test selection based on selected sample type
        function updateTestSelection(sampleId) {
            const labSelect = document.getElementById(`labSelect_${sampleId}`);
            const sampleTypeSelect = document.getElementById(`sampleType_${sampleId}`);
            const testSelect = document.getElementById(`testSelect_${sampleId}`);
            
            if (!labSelect || !sampleTypeSelect || !testSelect) return;
            
            const selectedLab = labSelect.value;
            const selectedSampleType = sampleTypeSelect.value;
            
            // Clear existing test options
            testSelect.innerHTML = '';
            
            if (selectedLab && selectedSampleType && labData[selectedLab]?.tests[selectedSampleType]) {
                // Add test options for the selected sample type
                labData[selectedLab].tests[selectedSampleType].forEach(test => {
                    const option = document.createElement('option');
                    option.value = test.code;
                    option.dataset.price = test.price;
                    option.textContent = `${test.code} - ${test.name} (Rs. ${test.price})`;
                    testSelect.appendChild(option);
                });
                
                // Enable the test selection
                testSelect.disabled = false;
                
                // Update the test table
                updateTestTable(sampleId);
            } else {
                // Disable test selection if no valid sample type is selected
                testSelect.disabled = true;
                updateTestTable(sampleId);
            }
        }
        
        // Update the test table with selected tests
        function updateTestTable(sampleId) {
            const testSelect = document.getElementById(`testSelect_${sampleId}`);
            const testTableBody = document.getElementById(`testTableBody_${sampleId}`);
            const totalAmountSpan = document.getElementById(`totalAmount_${sampleId}`);
            
            if (!testSelect || !testTableBody || !totalAmountSpan) return;
            
            // Clear existing table rows
            testTableBody.innerHTML = '';
            
            let totalAmount = 0;
            
            // Get selected options
            const selectedOptions = Array.from(testSelect.selectedOptions);
            
            if (selectedOptions.length === 0) {
                // If no tests are selected, show a message
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="3" class="text-center">No tests selected</td>';
                testTableBody.appendChild(row);
            } else {
                // Add a row for each selected test
                selectedOptions.forEach(option => {
                    const testCode = option.value;
                    const testName = option.textContent.split(' - ')[1].split(' (Rs. ')[0];
                    const testPrice = parseFloat(option.dataset.price) || 0;
                    
                    totalAmount += testPrice;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${testCode}</td>
                        <td>${testName}</td>
                        <td class="text-right">${testPrice.toLocaleString()}</td>
                    `;
                    testTableBody.appendChild(row);
                });
                
                // Add a total row
                const totalRow = document.createElement('tr');
                totalRow.className = 'font-weight-bold';
                totalRow.innerHTML = `
                    <td colspan="2" class="text-right">Subtotal:</td>
                    <td class="text-right">${totalAmount.toLocaleString()}</td>
                `;
                testTableBody.appendChild(totalRow);
            }
            
            // Update the total amount display
            totalAmountSpan.textContent = totalAmount.toLocaleString();
            
            // Update the grand total
            updateGrandTotal();
        }
        
        // Update the grand total of all samples
        function updateGrandTotal() {
            const totalAmounts = document.querySelectorAll('[id^="totalAmount_"]');
            let grandTotal = 0;
            
            totalAmounts.forEach(amountSpan => {
                const amount = parseFloat(amountSpan.textContent.replace(/,/g, '')) || 0;
                grandTotal += amount;
            });
            
            const grandTotalElement = document.getElementById('grandTotal');
            if (grandTotalElement) {
                grandTotalElement.textContent = grandTotal.toLocaleString();
            }
        }
        
        // Function to remove a sample
        function removeSample(sampleId) {
            if (confirm('Are you sure you want to remove this sample?')) {
                const sample = document.getElementById(`sample_${sampleId}`);
                if (sample) {
                    // Add a fade out effect before removing
                    sample.style.opacity = '0.5';
                    sample.style.transition = 'opacity 0.3s';
                    
                    setTimeout(() => {
                        sample.remove();
                        updateSampleNumbers();
                        updateGrandTotal();
                    }, 300);
                }
            }
        }
        
        // Update sample numbers after removal
        function updateSampleNumbers() {
            const samples = document.querySelectorAll('.sample-container');
            if (samples.length === 0) {
                sampleCounter = 0;
                return;
            }
            
            samples.forEach((container, index) => {
                const newId = index + 1;
                const oldId = container.dataset.sampleId;
                
                // Update IDs and data attributes
                container.id = `sample_${newId}`;
                container.dataset.sampleId = newId;
                
                // Update sample number in title
                const title = container.querySelector('.sample-title');
                if (title) title.textContent = `Sample #${newId}`;
                
                // Update all form fields with new IDs
                const fields = container.querySelectorAll('[id]');
                fields.forEach(field => {
                    field.id = field.id.replace(/_(\d+)(?=[^\d]|$)/, `_${newId}`);
                    if (field.name) field.name = field.name.replace(/\[(\d+)\]/, `[${newId}]`);
                    
                    // Update event handlers
                    if (field.onchange) {
                        const oldOnChange = field.onchange.toString();
                        const newOnChange = oldOnChange.replace(/'(\d+)'/g, `'${newId}'`);
                        field.onchange = new Function('return ' + newOnChange)();
                    }
                });
            });
            
            sampleCounter = samples.length;
        }
    </script>
</body>
</html>
